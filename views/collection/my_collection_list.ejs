<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chillinker</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/collection.css">
  <link rel="stylesheet" href="/css/colllection_modal.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@100;200;300;400;500;600;700&family=Sriracha&display=swap');
  </style>
  <script
    src="https://kit.fontawesome.com/0b832ce4c1.js"
    crossorigin="anonymous"
  ></script>
  <link
    rel="icon"
    type="image/png"
    sizes="16Ã—16"
    href="/logo_image/favicon-16x16.png"
  />
</head>
<body>
  <%- include('../header.ejs') %>
  <main>
    <div class="collection-list-upper">
      <h3><%= users.nickname %>ë‹˜ì˜ ì»¬ë ‰ì…˜</h3>
      <button class="add_collection_btn" id="add_collection_btn">+ìƒˆ ì»¬ë ‰ì…˜</button>
    </div>
    <input type="hidden" value="<%= collection %>" />
    <div class="collections_container">
      <% collection.forEach((item, index)=> { %>
        <span class="collectionId" id="collectionId-<%= index %>" style="display:none;"><%= item.id %></span>
        <div class="collection" >
          <div class="collection_upper">
            <img class="collection_img"
              id="collectionBtn-<%= index %>"
              src="<%= item.coverImage%>"
              alt="ì»¤ë²„ì´ë¯¸ì§€"
              onerror="this.src='/logo_image/chillinker_logo(2).png'"
              href="/collections/info/<%= item.id %>"
            />
            <div class="contents_number">
              ì‘í’ˆìˆ˜: <%= item.webContents.length || 0%>
            </div>
          </div>
          <div class="collection_info">
            <ul>
              <li class="collection_title" id="collectionBtn-<%= index %>" href="/collections/info/<%= item.id %>"><%= item.title %></li>
              <li class="collection_desc"><%= item.desc %></li>
              <li class="collection_bookmarked_number">ğŸ’›<%= item.bookmarkCount %>íšŒ</li>
              <li class="collection_btn_group">
                <button class="collection_content_adjust_btn" id="collection_content_adjust_btn-<%= index %>">ì‘í’ˆê´€ë¦¬</button>
                <button class="collection_edit_btn" id="collection_edit_btn-<%= index %>">ìˆ˜ì •</button>
                <button class="collection_delete_btn" id="collection_delete_btn-<%= index %>">ì‚­ì œ</button>
              </li>
            </ul>
            <!-- ì»¬ë ‰ì…˜ ë‚´ ì»¨í…ì¸  ì‚­ì œ ëª¨ë‹¬ì°½ -->
            <div class="remove-content-modal">
              <div class="collection_modal">
                <span class="close">&times;</span>
                <h3 id="remove-content-modal_title" class="remove-content-modal_title">ì»¬ë ‰ì…˜ ì»¨í…ì¸  ê´€ë¦¬</h3>
                <div class="modal_content">
                  <form
                    name="delete_content_form"
                    method="delete"
                    action="/collections/<%= item.id %>/content/<%= item.webContents.webContentId %>"
                    id="deleteContentForm"
                  >
                    <ul class="delete_content_list">       
                    </ul>
                  </form>
                </div>
              </div>
            </div>
            <!-- ì»¬ë ‰ì…˜ ìˆ˜ì • ëª¨ë‹¬ì°½ -->
            <div class="modify-colleciton-modal">
              <div class="collection_modal">
                <span class="close">&times;</span>
                <h3 class="modal_title">ì»¬ë ‰ì…˜ ìˆ˜ì •</h3>
                <div class="modal_content">
                  <form
                    name="update_collection_form"
                    method="post"
                    enctype="multipart/form-data"
                    id="updateCollectionForm"
                  >
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% }); %>
    </div>
    <!-- ì»¬ë ‰ì…˜ ìƒì„± ëª¨ë‹¬ì°½ -->
    <div class="add-collection-modal">
      <div class="collection_modal" id="collectionModal">
        <span class="close">&times;</span>
        <h3 class="modal_title">ìƒˆ ì»¬ë ‰ì…˜</h3>
        <div class="modal_content">
          <form
            name="add_collection_form"
            method="post"
            enctype="multipart/form-data"
            id="addCollectionForm"
          >
            <label for="cover">ì»¬ë ‰ì…˜ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
            <br />
            <input type="file" name="cover" id="cover" accept="image/*" />
            <br />
            <label for="title">ì»¬ë ‰ì…˜ ì œëª©</label>
            <input type="text" name="title" id="title" value="" />
            <br />
            <label for="desc">ì»¬ë ‰ì…˜ ì„¤ëª…</label>
            <textarea name="desc" id="desc" cols="30" rows="10"></textarea>
            <br />
            <div class="btn_area">
              <input type="submit" value="ì™„ë£Œ" />
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="/js/mycollection_list.js"></script>
 <script>
    function deleteContent (collectionId, webContentId) {
    $.ajax({
      url: `/collections/${collectionId}/content/${webContentId}`, // ë°ì´í„°ë¥¼ ì „ì†¡í•  ì„œë²„ì˜ URL
      type: 'DELETE',
      success: function (data) {
        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        location.reload(true);
      },
      error: function (response) {
        alert(response.responseJSON.message);
      },
    });
    }
    var collectionImgBtn = document.querySelectorAll('.collection_img')
    var collectiontitleBtn= document.querySelectorAll('.collection_title')
    collectionImgBtn.forEach(function(collectionImgBtn){
      collectionImgBtn.addEventListener('click', function(){
        const index =this.id.split('-')[1];
        const collectionId = document.getElementById(
            `collectionId-${index}`
          ).textContent
        window.location.href = `/collections/info/${collectionId}`
      })
    })
    collectiontitleBtn.forEach(function(collectiontitleBtn){
      collectiontitleBtn.addEventListener('click', function(){
        const index =this.id.split('-')[1];
        const collectionId = document.getElementById(
            `collectionId-${index}`
          ).textContent
        window.location.href = `/collections/info/${collectionId}`
      })
    })
  </script>
  <%- include('../footer.ejs') %>
</body>
